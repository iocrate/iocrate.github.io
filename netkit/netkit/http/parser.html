<!--?xml version="1.0" encoding="utf-8" ?--><!DOCTYPE html><!--  This file is generated by Nim. --><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Favicon -->
<link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAUAAAAF////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAIAAABbAAAAlQAAAKIAAACbAAAAmwAAAKIAAACVAAAAWwAAAAL///8A////AP///wD///8A////AAAAABQAAADAAAAAYwAAAA3///8A////AP///wD///8AAAAADQAAAGMAAADAAAAAFP///wD///8A////AP///wAAAACdAAAAOv///wD///8A////AP///wD///8A////AP///wD///8AAAAAOgAAAJ3///8A////AP///wAAAAAnAAAAcP///wAAAAAoAAAASv///wD///8A////AP///wAAAABKAAAAKP///wAAAABwAAAAJ////wD///8AAAAAgQAAABwAAACIAAAAkAAAAJMAAACtAAAAFQAAABUAAACtAAAAkwAAAJAAAACIAAAAHAAAAIH///8A////AAAAAKQAAACrAAAAaP///wD///8AAAAARQAAANIAAADSAAAARf///wD///8AAAAAaAAAAKsAAACk////AAAAADMAAACcAAAAnQAAABj///8A////AP///wAAAAAYAAAAGP///wD///8A////AAAAABgAAACdAAAAnAAAADMAAAB1AAAAwwAAAP8AAADpAAAAsQAAAE4AAAAb////AP///wAAAAAbAAAATgAAALEAAADpAAAA/wAAAMMAAAB1AAAAtwAAAOkAAAD/AAAA/wAAAP8AAADvAAAA3gAAAN4AAADeAAAA3gAAAO8AAAD/AAAA/wAAAP8AAADpAAAAtwAAAGUAAAA/AAAA3wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAADfAAAAPwAAAGX///8A////AAAAAEgAAADtAAAAvwAAAL0AAADGAAAA7wAAAO8AAADGAAAAvQAAAL8AAADtAAAASP///wD///8A////AP///wD///8AAAAAO////wD///8A////AAAAAIcAAACH////AP///wD///8AAAAAO////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//8AAP//AAD4HwAA7/cAAN/7AAD//wAAoYUAAJ55AACf+QAAh+EAAAAAAADAAwAA4AcAAP5/AAD//wAA//8AAA==">
<link rel="icon" type="image/png" sizes="32x32" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH4QQQEwksSS9ZWwAAAk1JREFUWMPtll2ITVEUx39nn/O7Y5qR8f05wtCUUr6ZIS++8pEnkZInPImneaCQ5METNdOkeFBKUhMPRIkHKfEuUZSUlGlKPN2TrgfncpvmnntnmlEyq1Z7t89/rf9a6+y99oZxGZf/XeIq61EdtgKXgdXA0xrYAvBjOIF1AI9zvjcC74BSpndrJPkBWDScTF8Aa4E3wDlgHbASaANmVqlcCnwHvgDvgVfAJ+AikAAvgfVZwLnSVZHZaOuKoQi3ZOMi4NkYkpe1p4J7A8BpYAD49hfIy/oqG0+hLomiKP2L5L+1ubn5115S+3OAn4EnwBlgMzCjyt6ZAnQCJ4A7wOs88iRJHvw50HoujuPBoCKwHWiosy8MdfZnAdcHk8dxXFJ3VQbQlCTJvRBCGdRbD4M6uc5glpY3eAihpN5S5w12diSEcCCEcKUO4ljdr15T76ur1FDDLIQQ3qv71EdDOe3Kxj3leRXyk+pxdWnFWod6Wt2bY3de3aSuUHcPBVimHs7mK9WrmeOF6lR1o9qnzskh2ar2qm1qizpfXaPeVGdlmGN5pb09qMxz1Xb1kLqgzn1RyH7JUXW52lr5e/Kqi9qpto7V1atuUzfnARrV7jEib1T76gG2qxdGmXyiekkt1GswPTtek0aBfJp6YySGBfWg2tPQ0FAYgf1stUfdmdcjarbYJEniKIq6gY/Aw+zWHAC+p2labGpqiorFYgGYCEzN7oQdQClN07O1/EfDyGgC0ALMBdYAi4FyK+4H3gLPsxfR1zRNi+NP7nH5J+QntnXe5B5mpfQAAAAASUVORK5CYII=">

<!-- Google fonts -->
<link href="https://fonts.googleapis.com/css?family=Lato:400,600,900" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,500,600" rel="stylesheet" type="text/css">

<!-- CSS -->
<title>netkit/http/parser</title>
<link rel="stylesheet" type="text/css" href="../../nimdoc.out.css">

<script type="text/javascript" src="/dochack.js"></script>

<script type="text/javascript">
function main() {
  var pragmaDots = document.getElementsByClassName("pragmadots");
  for (var i = 0; i < pragmaDots.length; i++) {
    pragmaDots[i].onclick = function(event) {
      // Hide tease
      event.target.parentNode.style.display = "none";
      // Show actual
      event.target.parentNode.nextElementSibling.style.display = "inline";
    }
  }

  const toggleSwitch = document.querySelector('.theme-switch input[type="checkbox"]');
  function switchTheme(e) {
      if (e.target.checked) {
          document.documentElement.setAttribute('data-theme', 'dark');
          localStorage.setItem('theme', 'dark');
      } else {
          document.documentElement.setAttribute('data-theme', 'light');
          localStorage.setItem('theme', 'light');
      }
  }

  toggleSwitch.addEventListener('change', switchTheme, false);


  if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
    document.documentElement.setAttribute('data-theme', "dark");
    toggleSwitch.checked = true;
  } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) {
    document.documentElement.setAttribute('data-theme', "light");
    toggleSwitch.checked = false;
  } else {
    const currentTheme = localStorage.getItem('theme') ? localStorage.getItem('theme') : null;
    if (currentTheme) {
      document.documentElement.setAttribute('data-theme', currentTheme);

      if (currentTheme === 'dark') {
        toggleSwitch.checked = true;
      }
    }
  }
}
</script>

<style>
    h1 {
      border-bottom: none;
    }
    
    .container h1.title {
      width: 80.0%;
    }
    .container > .row > .columns:first-of-type {
      float: none;
      position: fixed;
      right: 0;
      top: 0;
      width: 18%;
      height: 100%;
      padding-top: 40px;
    }
    .footer {
      width: 80.0%;
    }
    #toc-list {
      height: calc(100% - 169px);
      overflow-y: hidden;
    }
    #toc-list:hover {
      overflow-y: auto;
    }
    #content.columns {
      margin-left: auto;
      margin-left: 1%;
      margin-right: 1%;
    }
  
    pre {
      width: 100%;
      overflow: hidden;
      padding: 0.5em 1em;
    }
    pre:hover {
      overflow: auto;
    }
  
    .pre {
      font-family: Fira Code,Anonymous Pro,Monaco,Menlo,Consolas,Droid Sans Mono,Monospace;
      display: inline-block;
      padding: 0px 0.3em;
      color: #2a6e6b; /*#2a6e6b #4a7e7b*/
      font-weight: bold;
      border-radius: 2px;
      background-color: transparent;
    }

    .r-fragment {
      padding: 0 0 0 30px;
      border-left: 1px solid rgb(216,216,216);
      margin: 40px 0;
    }

    .r-ol {
      padding-left: 1em;
    }

    p {
      margin-top: 20px;
      margin-bottom: 20px;
    }
  </style></head>
<body onload="main()">
<div class="document" id="documentId">
  <div class="container">
    <h1 class="title">netkit/http/parser</h1>
    <div class="row">
  <div class="three columns">
  <div class="theme-switch-wrapper">
    <label class="theme-switch" for="checkbox">
      <input type="checkbox" id="checkbox">
      <div class="slider round"></div>
    </label>
    &nbsp;&nbsp;&nbsp; <em>Dark Mode</em>
  </div>
  <div id="global-links">
    <ul class="simple">
    </ul>
  </div>
  <div id="searchInputDiv">
    Search: <input type="text" id="searchInput" onkeyup="search()">
  </div>
  <div>
    Group by:
    <select onchange="groupBy(this.value)">
      <option value="section">Section</option>
      <option value="type">Type</option>
    </select>
  </div>
  <ul class="simple simple-toc" id="toc-list">
<li><a class="reference" id="usage_toc" href="#usage">Usage</a></li>
<ul class="simple"><li><a class="reference" id="usage-parse-message-header_toc" href="#usage-parse-message-header">Parse message header</a></li>
<li><a class="reference" id="usage-parse-chunk-header_toc" href="#usage-parse-chunk-header">Parse chunk header</a></li>
<li><a class="reference" id="usage-parse-chunk-tail_toc" href="#usage-parse-chunk-tail">Parse chunk tail</a></li>
</ul><li>
  <a class="reference reference-toplevel" href="#6" id="56">Imports</a>
  <ul class="simple simple-toc-section">
    
  </ul>
</li>
<li>
  <a class="reference reference-toplevel" href="#7" id="57">Types</a>
  <ul class="simple simple-toc-section">
      <li><a class="reference" href="#HttpParser" title="HttpParser = object
  secondaryBuffer: string
  currentLineLen: Natural
  currentFieldName: string
  currentFieldCount: Natural
  state: HttpParseState
  startLineState: StartLineState"><wbr>Http<wbr>Parser<span class="attachedType"></span></a></li>

  </ul>
</li>
<li>
  <a class="reference reference-toplevel" href="#12" id="62">Procs</a>
  <ul class="simple simple-toc-section">
      <li><a class="reference" href="#initHttpParser" title="initHttpParser(): HttpParser"><wbr>init<wbr>Http<wbr>Parser<span class="attachedType">HttpParser</span></a></li>
  <li><a class="reference" href="#clear%2CHttpParser" title="clear(p: var HttpParser)"><wbr>clear<span class="attachedType">HttpParser</span></a></li>
  <li><a class="reference" href="#parseHttpHeader%2CHttpParser%2CMarkableCircularBuffer%2CHttpHeader" title="parseHttpHeader(p: var HttpParser; buf: var MarkableCircularBuffer;
                header: var HttpHeader): bool"><wbr>parse<wbr>Http<wbr>Header<span class="attachedType">HttpParser</span></a></li>
  <li><a class="reference" href="#parseChunkHeader%2CHttpParser%2CMarkableCircularBuffer%2CChunkHeader" title="parseChunkHeader(p: var HttpParser; buf: var MarkableCircularBuffer;
                 header: var ChunkHeader): bool"><wbr>parse<wbr>Chunk<wbr>Header<span class="attachedType">HttpParser</span></a></li>
  <li><a class="reference" href="#parseChunkEnd%2CHttpParser%2CMarkableCircularBuffer%2Cseq%5Bstring%5D" title="parseChunkEnd(p: var HttpParser; buf: var MarkableCircularBuffer;
              trailers: var seq[string]): bool"><wbr>parse<wbr>Chunk<wbr>End<span class="attachedType">HttpParser</span></a></li>

  </ul>
</li>

</ul>

  </div>
  <div class="nine columns" id="content">
  <div id="tocRoot"></div>
  
  <p class="module-desc"></p><p>This module implements an incremental HTTP parser. This parser supports parsing both request messages and response messages.</p>
<p>This parser is incremental, meaning that the message can be parsed continuously regardless of whether the message is delivered at once or divided into multiple parts. This makes the parser particularly suitable for complex IO transfer environments.</p>

<h1><a class="toc-backref" id="usage" href="#usage">Usage</a></h1><div class="r-fragment">
<h2><a class="toc-backref" id="usage-parse-message-header" href="#usage-parse-message-header">Parse message header</a></h2><p>For example:</p>
<pre class="listing"><span class="Keyword">import</span> <span class="Identifier">netkit</span><span class="Operator">/</span><span class="Identifier">http</span><span class="Operator">/</span><span class="Identifier">parser</span>
<span class="Keyword">import</span> <span class="Identifier">netkit</span><span class="Operator">/</span><span class="Identifier">http</span><span class="Operator">/</span><span class="Identifier">header</span>
<span class="Keyword">import</span> <span class="Identifier">netkit</span><span class="Operator">/</span><span class="Identifier">buffer</span><span class="Operator">/</span><span class="Identifier">circular</span>

<span class="Keyword">var</span> <span class="Identifier">parser</span> <span class="Operator">=</span> <span class="Identifier">initHttpParser</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
<span class="Keyword">var</span> <span class="Identifier">buffer</span> <span class="Operator">=</span> <span class="Identifier">initMarkableCircularBuffer</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
<span class="Keyword">var</span> <span class="Identifier">header</span> <span class="Operator">=</span> <span class="Identifier">HttpHeader</span><span class="Punctuation">(</span><span class="Identifier">kind</span><span class="Punctuation">:</span> <span class="Identifier">HttpHeaderKind</span><span class="Operator">.</span><span class="Identifier">Request</span><span class="Punctuation">)</span>
<span class="Keyword">var</span> <span class="Identifier">finished</span> <span class="Operator">=</span> <span class="Identifier">false</span>

<span class="Keyword">while</span> <span class="Keyword">not</span> <span class="Identifier">finished</span><span class="Punctuation">:</span>
  <span class="Identifier">put</span> <span class="Identifier">data</span> <span class="Identifier">to</span> <span class="Identifier">buffer</span> <span class="Operator">...</span>
  <span class="Identifier">finished</span> <span class="Operator">=</span> <span class="Identifier">parser</span><span class="Operator">.</span><span class="Identifier">parseHttpHeader</span><span class="Punctuation">(</span><span class="Identifier">buffer</span><span class="Punctuation">,</span> <span class="Identifier">header</span><span class="Punctuation">)</span></pre><p>Another example:</p>
<pre class="listing"><span class="Keyword">import</span> <span class="Identifier">netkit</span><span class="Operator">/</span><span class="Identifier">http</span><span class="Operator">/</span><span class="Identifier">parser</span>
<span class="Keyword">import</span> <span class="Identifier">netkit</span><span class="Operator">/</span><span class="Identifier">http</span><span class="Operator">/</span><span class="Identifier">header</span>
<span class="Keyword">import</span> <span class="Identifier">netkit</span><span class="Operator">/</span><span class="Identifier">buffer</span><span class="Operator">/</span><span class="Identifier">circular</span>

<span class="Keyword">var</span> <span class="Identifier">parser</span> <span class="Operator">=</span> <span class="Identifier">initHttpParser</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
<span class="Keyword">var</span> <span class="Identifier">buffer</span> <span class="Operator">=</span> <span class="Identifier">initMarkableCircularBuffer</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
<span class="Keyword">var</span> <span class="Identifier">header</span> <span class="Operator">=</span> <span class="Identifier">HttpHeader</span><span class="Punctuation">(</span><span class="Identifier">kind</span><span class="Punctuation">:</span> <span class="Identifier">HttpHeaderKind</span><span class="Operator">.</span><span class="Identifier">Request</span><span class="Punctuation">)</span>

<span class="Comment"># parse first</span>
<span class="Keyword">let</span> <span class="Identifier">messageRequestLine</span> <span class="Operator">=</span> <span class="StringLit">"GET / HTTP/1.1</span><span class="EscapeSequence">\r</span><span class="EscapeSequence">\n</span><span class="StringLit">"</span>
<span class="Identifier">buffer</span><span class="Operator">.</span><span class="Identifier">add</span><span class="Punctuation">(</span><span class="Identifier">messageRequestLine</span><span class="Operator">.</span><span class="Identifier">cstring</span><span class="Punctuation">,</span> <span class="Identifier">messageRequestLine</span><span class="Operator">.</span><span class="Identifier">len</span><span class="Punctuation">)</span>
<span class="Identifier">assert</span> <span class="Identifier">parser</span><span class="Operator">.</span><span class="Identifier">parseHttpHeader</span><span class="Punctuation">(</span><span class="Identifier">buffer</span><span class="Punctuation">,</span> <span class="Identifier">header</span><span class="Punctuation">)</span> <span class="Operator">==</span> <span class="Identifier">false</span>
<span class="Identifier">buffer</span><span class="Operator">.</span><span class="Identifier">del</span><span class="Punctuation">(</span><span class="Identifier">messageRequestLine</span><span class="Operator">.</span><span class="Identifier">len</span><span class="Punctuation">)</span>

<span class="Comment"># parse second</span>
<span class="Keyword">let</span> <span class="Identifier">messageHeaderFields</span> <span class="Operator">=</span> <span class="StringLit">"Host: www.iocrate.com</span><span class="EscapeSequence">\r</span><span class="EscapeSequence">\n</span><span class="EscapeSequence">\r</span><span class="EscapeSequence">\n</span><span class="StringLit">"</span>
<span class="Identifier">buffer</span><span class="Operator">.</span><span class="Identifier">add</span><span class="Punctuation">(</span><span class="Identifier">messageHeaderFields</span><span class="Operator">.</span><span class="Identifier">cstring</span><span class="Punctuation">,</span> <span class="Identifier">messageHeaderFields</span><span class="Operator">.</span><span class="Identifier">len</span><span class="Punctuation">)</span>
<span class="Identifier">assert</span> <span class="Identifier">parser</span><span class="Operator">.</span><span class="Identifier">parseHttpHeader</span><span class="Punctuation">(</span><span class="Identifier">buffer</span><span class="Punctuation">,</span> <span class="Identifier">header</span><span class="Punctuation">)</span> <span class="Operator">==</span> <span class="Identifier">true</span>
<span class="Identifier">buffer</span><span class="Operator">.</span><span class="Identifier">del</span><span class="Punctuation">(</span><span class="Identifier">messageHeaderFields</span><span class="Operator">.</span><span class="Identifier">len</span><span class="Punctuation">)</span>

<span class="Identifier">assert</span> <span class="Identifier">header</span><span class="Operator">.</span><span class="Identifier">reqMethod</span> <span class="Operator">==</span> <span class="Identifier">HttpGet</span>
<span class="Identifier">assert</span> <span class="Identifier">header</span><span class="Operator">.</span><span class="Identifier">url</span> <span class="Operator">==</span> <span class="StringLit">"/"</span>
<span class="Identifier">assert</span> <span class="Identifier">header</span><span class="Operator">.</span><span class="Identifier">version</span><span class="Operator">.</span><span class="Identifier">orig</span> <span class="Operator">==</span> <span class="StringLit">"HTTP/1.1"</span>
<span class="Identifier">assert</span> <span class="Identifier">header</span><span class="Operator">.</span><span class="Identifier">fields</span><span class="Punctuation">[</span><span class="StringLit">"Host"</span><span class="Punctuation">]</span><span class="Punctuation">[</span><span class="DecNumber">0</span><span class="Punctuation">]</span> <span class="Operator">==</span> <span class="StringLit">"www.iocrate.com"</span></pre></div><div class="r-fragment">
<h2><a class="toc-backref" id="usage-parse-chunk-header" href="#usage-parse-chunk-header">Parse chunk header</a></h2><p>For example:</p>
<pre class="listing"><span class="Keyword">import</span> <span class="Identifier">netkit</span><span class="Operator">/</span><span class="Identifier">http</span><span class="Operator">/</span><span class="Identifier">parser</span>
<span class="Keyword">import</span> <span class="Identifier">netkit</span><span class="Operator">/</span><span class="Identifier">http</span><span class="Operator">/</span><span class="Identifier">chunk</span>
<span class="Keyword">import</span> <span class="Identifier">netkit</span><span class="Operator">/</span><span class="Identifier">buffer</span><span class="Operator">/</span><span class="Identifier">circular</span>

<span class="Keyword">var</span> <span class="Identifier">parser</span> <span class="Operator">=</span> <span class="Identifier">initHttpParser</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
<span class="Keyword">var</span> <span class="Identifier">buffer</span> <span class="Operator">=</span> <span class="Identifier">initMarkableCircularBuffer</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
<span class="Keyword">var</span> <span class="Identifier">header</span><span class="Punctuation">:</span> <span class="Identifier">ChunkHeader</span>
<span class="Keyword">var</span> <span class="Identifier">finished</span> <span class="Operator">=</span> <span class="Identifier">false</span>

<span class="Keyword">while</span> <span class="Keyword">not</span> <span class="Identifier">finished</span><span class="Punctuation">:</span>
  <span class="Identifier">put</span> <span class="Identifier">data</span> <span class="Identifier">to</span> <span class="Identifier">buffer</span> <span class="Operator">...</span>
  <span class="Identifier">finished</span> <span class="Operator">=</span> <span class="Identifier">parser</span><span class="Operator">.</span><span class="Identifier">parseChunkHeader</span><span class="Punctuation">(</span><span class="Identifier">buffer</span><span class="Punctuation">,</span> <span class="Identifier">header</span><span class="Punctuation">)</span></pre><p>Another example:</p>
<pre class="listing"><span class="Keyword">import</span> <span class="Identifier">netkit</span><span class="Operator">/</span><span class="Identifier">http</span><span class="Operator">/</span><span class="Identifier">parser</span>
<span class="Keyword">import</span> <span class="Identifier">netkit</span><span class="Operator">/</span><span class="Identifier">http</span><span class="Operator">/</span><span class="Identifier">chunk</span>
<span class="Keyword">import</span> <span class="Identifier">netkit</span><span class="Operator">/</span><span class="Identifier">buffer</span><span class="Operator">/</span><span class="Identifier">circular</span>

<span class="Keyword">var</span> <span class="Identifier">parser</span> <span class="Operator">=</span> <span class="Identifier">initHttpParser</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
<span class="Keyword">var</span> <span class="Identifier">buffer</span> <span class="Operator">=</span> <span class="Identifier">initMarkableCircularBuffer</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
<span class="Keyword">var</span> <span class="Identifier">header</span><span class="Punctuation">:</span> <span class="Identifier">ChunkHeader</span>

<span class="Comment"># parse first</span>
<span class="Keyword">let</span> <span class="Identifier">s</span> <span class="Operator">=</span> <span class="StringLit">"9; language=en; city=London</span><span class="EscapeSequence">\r</span><span class="EscapeSequence">\n</span><span class="StringLit">"</span>
<span class="Identifier">buffer</span><span class="Operator">.</span><span class="Identifier">add</span><span class="Punctuation">(</span><span class="Identifier">s</span><span class="Operator">.</span><span class="Identifier">cstring</span><span class="Punctuation">,</span> <span class="Identifier">s</span><span class="Operator">.</span><span class="Identifier">len</span><span class="Punctuation">)</span>
<span class="Identifier">assert</span> <span class="Identifier">parser</span><span class="Operator">.</span><span class="Identifier">parseChunkHeader</span><span class="Punctuation">(</span><span class="Identifier">buffer</span><span class="Punctuation">,</span> <span class="Identifier">header</span><span class="Punctuation">)</span> <span class="Operator">==</span> <span class="Identifier">true</span>
<span class="Identifier">buffer</span><span class="Operator">.</span><span class="Identifier">del</span><span class="Punctuation">(</span><span class="Identifier">s</span><span class="Operator">.</span><span class="Identifier">len</span><span class="Punctuation">)</span>

<span class="Identifier">assert</span> <span class="Identifier">header</span><span class="Operator">.</span><span class="Identifier">size</span> <span class="Operator">==</span> <span class="DecNumber">9</span>
<span class="Identifier">assert</span> <span class="Identifier">header</span><span class="Operator">.</span><span class="Identifier">extensions</span> <span class="Operator">==</span> <span class="StringLit">"; language=en; city=London"</span></pre><p>See <strong>chunk</strong> module and <strong>metadata</strong> module for more information about chunked encoding.</p>
</div><div class="r-fragment">
<h2><a class="toc-backref" id="usage-parse-chunk-tail" href="#usage-parse-chunk-tail">Parse chunk tail</a></h2><p>For example:</p>
<pre class="listing"><span class="Keyword">import</span> <span class="Identifier">netkit</span><span class="Operator">/</span><span class="Identifier">http</span><span class="Operator">/</span><span class="Identifier">parser</span>
<span class="Keyword">import</span> <span class="Identifier">netkit</span><span class="Operator">/</span><span class="Identifier">http</span><span class="Operator">/</span><span class="Identifier">chunk</span>
<span class="Keyword">import</span> <span class="Identifier">netkit</span><span class="Operator">/</span><span class="Identifier">buffer</span><span class="Operator">/</span><span class="Identifier">circular</span>

<span class="Keyword">var</span> <span class="Identifier">parser</span> <span class="Operator">=</span> <span class="Identifier">initHttpParser</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
<span class="Keyword">var</span> <span class="Identifier">buffer</span> <span class="Operator">=</span> <span class="Identifier">initMarkableCircularBuffer</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
<span class="Keyword">var</span> <span class="Identifier">trailers</span><span class="Punctuation">:</span> <span class="Identifier">seq</span><span class="Punctuation">[</span><span class="Identifier">string</span><span class="Punctuation">]</span>
<span class="Keyword">var</span> <span class="Identifier">finished</span> <span class="Operator">=</span> <span class="Identifier">false</span>

<span class="Keyword">while</span> <span class="Keyword">not</span> <span class="Identifier">finished</span><span class="Punctuation">:</span>
  <span class="Identifier">put</span> <span class="Identifier">data</span> <span class="Identifier">to</span> <span class="Identifier">buffer</span> <span class="Operator">...</span>
  <span class="Identifier">finished</span> <span class="Operator">=</span> <span class="Identifier">parser</span><span class="Operator">.</span><span class="Identifier">parseChunkEnd</span><span class="Punctuation">(</span><span class="Identifier">buffer</span><span class="Punctuation">,</span> <span class="Identifier">trailers</span><span class="Punctuation">)</span></pre><p>Another example:</p>
<pre class="listing"><span class="Keyword">import</span> <span class="Identifier">netkit</span><span class="Operator">/</span><span class="Identifier">http</span><span class="Operator">/</span><span class="Identifier">parser</span>
<span class="Keyword">import</span> <span class="Identifier">netkit</span><span class="Operator">/</span><span class="Identifier">http</span><span class="Operator">/</span><span class="Identifier">chunk</span>
<span class="Keyword">import</span> <span class="Identifier">netkit</span><span class="Operator">/</span><span class="Identifier">buffer</span><span class="Operator">/</span><span class="Identifier">circular</span>

<span class="Keyword">var</span> <span class="Identifier">parser</span> <span class="Operator">=</span> <span class="Identifier">initHttpParser</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
<span class="Keyword">var</span> <span class="Identifier">buffer</span> <span class="Operator">=</span> <span class="Identifier">initMarkableCircularBuffer</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
<span class="Keyword">var</span> <span class="Identifier">trailers</span><span class="Punctuation">:</span> <span class="Identifier">seq</span><span class="Punctuation">[</span><span class="Identifier">string</span><span class="Punctuation">]</span>

<span class="Comment"># parse first</span>
<span class="Keyword">let</span> <span class="Identifier">s</span> <span class="Operator">=</span> <span class="StringLit">"</span><span class="EscapeSequence">\0</span><span class="EscapeSequence">\r</span><span class="EscapeSequence">\n</span><span class="StringLit">Expires"</span><span class="Punctuation">:</span> <span class="StringLit">"Wed, 21 Oct 2015 07:28:00 GMT</span><span class="EscapeSequence">\r</span><span class="EscapeSequence">\n</span><span class="EscapeSequence">\r</span><span class="EscapeSequence">\n</span><span class="StringLit">"</span>
<span class="Identifier">buffer</span><span class="Operator">.</span><span class="Identifier">add</span><span class="Punctuation">(</span><span class="Identifier">s</span><span class="Operator">.</span><span class="Identifier">cstring</span><span class="Punctuation">,</span> <span class="Identifier">s</span><span class="Operator">.</span><span class="Identifier">len</span><span class="Punctuation">)</span>
<span class="Identifier">assert</span> <span class="Identifier">parser</span><span class="Operator">.</span><span class="Identifier">parseChunkEnd</span><span class="Punctuation">(</span><span class="Identifier">buffer</span><span class="Punctuation">,</span> <span class="Identifier">trailers</span><span class="Punctuation">)</span> <span class="Operator">==</span> <span class="Identifier">true</span>
<span class="Identifier">buffer</span><span class="Operator">.</span><span class="Identifier">del</span><span class="Punctuation">(</span><span class="Identifier">s</span><span class="Operator">.</span><span class="Identifier">len</span><span class="Punctuation">)</span>

<span class="Identifier">assert</span> <span class="Identifier">trailers</span><span class="Punctuation">[</span><span class="DecNumber">0</span><span class="Punctuation">]</span> <span class="Operator">==</span> <span class="StringLit">"Expires"</span><span class="Punctuation">:</span> <span class="StringLit">"Wed, 21 Oct 2015 07:28:00 GMT"</span></pre><p>See <strong>chunk</strong> module and <strong>metadata</strong> module for more information about terminating chunk and trailers.</p>
</div><p></p>
  <div class="section" id="6">
<h1><a class="toc-backref" href="#6">Imports</a></h1>
<dl class="item">
<a class="reference external" href="../buffer/circular.html">../buffer/circular</a>, <a class="reference external" href="limits.html">limits</a>, <a class="reference external" href="exception.html">exception</a>, <a class="reference external" href="spec.html">spec</a>, <a class="reference external" href="httpmethod.html">httpmethod</a>, <a class="reference external" href="version.html">version</a>, <a class="reference external" href="status.html">status</a>, <a class="reference external" href="headerfield.html">headerfield</a>, <a class="reference external" href="header.html">header</a>, <a class="reference external" href="chunk.html">chunk</a>
</dl></div>
<div class="section" id="7">
<h1><a class="toc-backref" href="#7">Types</a></h1>
<dl class="item">
<a id="HttpParser"></a>
<dt><pre><a href="parser.html#HttpParser"><span class="Identifier">HttpParser</span></a> <span class="Other">=</span> <span class="Keyword">object</span>
  <span class="Identifier">secondaryBuffer</span><span class="Other">:</span> <span class="Identifier">string</span>
  <span class="Identifier">currentLineLen</span><span class="Other">:</span> <span class="Identifier">Natural</span>
  <span class="Identifier">currentFieldName</span><span class="Other">:</span> <span class="Identifier">string</span>
  <span class="Identifier">currentFieldCount</span><span class="Other">:</span> <span class="Identifier">Natural</span>
  <span class="Identifier">state</span><span class="Other">:</span> <span class="Identifier">HttpParseState</span>
  <span class="Identifier">startLineState</span><span class="Other">:</span> <span class="Identifier">StartLineState</span>
</pre></dt>
<dd>

HTTP message parser.
&nbsp;&nbsp;<a href="https://github.com/iocrate/netkit/tree/master/netkit/http/parser.nim#L171" class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/iocrate/netkit/edit/devel/netkit/http/parser.nim#L171" class="link-seesrc" target="_blank">Edit</a>

</dd>

</dl></div>
<div class="section" id="12">
<h1><a class="toc-backref" href="#12">Procs</a></h1>
<dl class="item">
<a id="initHttpParser"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#initHttpParser"><span class="Identifier">initHttpParser</span></a><span class="Other">(</span><span class="Other">)</span><span class="Other">:</span> <a href="parser.html#HttpParser"><span class="Identifier">HttpParser</span></a> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Initialize a <tt class="docutils literal"><span class="pre">HttpParser</span></tt>.
&nbsp;&nbsp;<a href="https://github.com/iocrate/netkit/tree/master/netkit/http/parser.nim#L188" class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/iocrate/netkit/edit/devel/netkit/http/parser.nim#L188" class="link-seesrc" target="_blank">Edit</a>

</dd>
<a id="clear,HttpParser"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#clear%2CHttpParser"><span class="Identifier">clear</span></a><span class="Other">(</span><span class="Identifier">p</span><span class="Other">:</span> <span class="Keyword">var</span> <a href="parser.html#HttpParser"><span class="Identifier">HttpParser</span></a><span class="Other">)</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

<p>Reset this parser to clear all status.</p>
<p>Since <tt class="docutils literal"><span class="pre">HttpParser</span></tt> is an incremental, various state will be saved during the parsing process. This proc resets all states in order to start a new parsing process.</p>

&nbsp;&nbsp;<a href="https://github.com/iocrate/netkit/tree/master/netkit/http/parser.nim#L192" class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/iocrate/netkit/edit/devel/netkit/http/parser.nim#L192" class="link-seesrc" target="_blank">Edit</a>

</dd>
<a id="parseHttpHeader,HttpParser,MarkableCircularBuffer,HttpHeader"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#parseHttpHeader%2CHttpParser%2CMarkableCircularBuffer%2CHttpHeader"><span class="Identifier">parseHttpHeader</span></a><span class="Other">(</span><span class="Identifier">p</span><span class="Other">:</span> <span class="Keyword">var</span> <a href="parser.html#HttpParser"><span class="Identifier">HttpParser</span></a><span class="Other">;</span> <span class="Identifier">buf</span><span class="Other">:</span> <span class="Keyword">var</span> <a href="../buffer/circular.html#MarkableCircularBuffer"><span class="Identifier">MarkableCircularBuffer</span></a><span class="Other">;</span>
                    <span class="Identifier">header</span><span class="Other">:</span> <span class="Keyword">var</span> <a href="header.html#HttpHeader"><span class="Identifier">HttpHeader</span></a><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">bool</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma">
    <span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Identifier">HttpError</span><span class="Other">,</span> <span class="Identifier">ValueError</span><span class="Other">,</span> <span class="Identifier">Exception</span><span class="Other">,</span> <span class="Identifier">KeyError</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

<p>Parses the header of a HTTP message. <tt class="docutils literal"><span class="pre">buf</span></tt> specifies a circular buffer, which stores the data to be parsed. <tt class="docutils literal"><span class="pre">header</span></tt> specifies the message header object that output when the parsing is complete. Returns <tt class="docutils literal"><span class="pre">true</span></tt> if the parsing is complete.</p>
<p>Depending on the value of the <tt class="docutils literal"><span class="pre">kind</span></tt> attribute of <tt class="docutils literal"><span class="pre">header</span></tt>, different resolutions are taken. When <tt class="docutils literal"><span class="pre">kind=Request</span></tt>, a message is parsed as a request. When <tt class="docutils literal"><span class="pre">kind=Response</span></tt>, a message is parsed as a request.</p>
<p>This process is performed incrementally, that is, the next parsing will continue from the previous position.</p>

&nbsp;&nbsp;<a href="https://github.com/iocrate/netkit/tree/master/netkit/http/parser.nim#L259" class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/iocrate/netkit/edit/devel/netkit/http/parser.nim#L259" class="link-seesrc" target="_blank">Edit</a>

</dd>
<a id="parseChunkHeader,HttpParser,MarkableCircularBuffer,ChunkHeader"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#parseChunkHeader%2CHttpParser%2CMarkableCircularBuffer%2CChunkHeader"><span class="Identifier">parseChunkHeader</span></a><span class="Other">(</span><span class="Identifier">p</span><span class="Other">:</span> <span class="Keyword">var</span> <a href="parser.html#HttpParser"><span class="Identifier">HttpParser</span></a><span class="Other">;</span> <span class="Identifier">buf</span><span class="Other">:</span> <span class="Keyword">var</span> <a href="../buffer/circular.html#MarkableCircularBuffer"><span class="Identifier">MarkableCircularBuffer</span></a><span class="Other">;</span>
                     <span class="Identifier">header</span><span class="Other">:</span> <span class="Keyword">var</span> <a href="chunk.html#ChunkHeader"><span class="Identifier">ChunkHeader</span></a><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">bool</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma">
    <span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Identifier">HttpError</span><span class="Other">,</span> <span class="Identifier">ValueError</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

<p>Parse the size and extensions of a data chunk that encoded by <tt class="docutils literal"><span class="pre">Transfor-Encoding: chunked</span></tt>.</p>
<p>This process is performed incrementally, that is, the next parsing will continue from the previous position.</p>

&nbsp;&nbsp;<a href="https://github.com/iocrate/netkit/tree/master/netkit/http/parser.nim#L366" class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/iocrate/netkit/edit/devel/netkit/http/parser.nim#L366" class="link-seesrc" target="_blank">Edit</a>

</dd>
<a id="parseChunkEnd,HttpParser,MarkableCircularBuffer,seq[string]"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#parseChunkEnd%2CHttpParser%2CMarkableCircularBuffer%2Cseq%5Bstring%5D"><span class="Identifier">parseChunkEnd</span></a><span class="Other">(</span><span class="Identifier">p</span><span class="Other">:</span> <span class="Keyword">var</span> <a href="parser.html#HttpParser"><span class="Identifier">HttpParser</span></a><span class="Other">;</span> <span class="Identifier">buf</span><span class="Other">:</span> <span class="Keyword">var</span> <a href="../buffer/circular.html#MarkableCircularBuffer"><span class="Identifier">MarkableCircularBuffer</span></a><span class="Other">;</span>
                  <span class="Identifier">trailers</span><span class="Other">:</span> <span class="Keyword">var</span> <span class="Identifier">seq</span><span class="Other">[</span><span class="Identifier">string</span><span class="Other">]</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">bool</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Identifier">HttpError</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

<p>Parse the tail of a message that encoded by <tt class="docutils literal"><span class="pre">Transfor-Encoding: chunked</span></tt>.</p>
<p>This process is performed incrementally, that is, the next parsing will continue from the previous position.</p>

&nbsp;&nbsp;<a href="https://github.com/iocrate/netkit/tree/master/netkit/http/parser.nim#L392" class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/iocrate/netkit/edit/devel/netkit/http/parser.nim#L392" class="link-seesrc" target="_blank">Edit</a>

</dd>

</dl></div>

  </div>
</div>

    <div class="row">
      <div class="twelve-columns footer">
        <span class="nim-sprite"></span>
        <br>
        <small style="color: var(--hint);">Made with Nim. Generated: 2020-04-28 04:11:52 UTC</small>
      </div>
    </div>
  </div>
</div>



</body></html>