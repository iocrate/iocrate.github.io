<!--?xml version="1.0" encoding="utf-8" ?--><!DOCTYPE html><!--  This file is generated by Nim. --><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Favicon -->
<link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAUAAAAF////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAIAAABbAAAAlQAAAKIAAACbAAAAmwAAAKIAAACVAAAAWwAAAAL///8A////AP///wD///8A////AAAAABQAAADAAAAAYwAAAA3///8A////AP///wD///8AAAAADQAAAGMAAADAAAAAFP///wD///8A////AP///wAAAACdAAAAOv///wD///8A////AP///wD///8A////AP///wD///8AAAAAOgAAAJ3///8A////AP///wAAAAAnAAAAcP///wAAAAAoAAAASv///wD///8A////AP///wAAAABKAAAAKP///wAAAABwAAAAJ////wD///8AAAAAgQAAABwAAACIAAAAkAAAAJMAAACtAAAAFQAAABUAAACtAAAAkwAAAJAAAACIAAAAHAAAAIH///8A////AAAAAKQAAACrAAAAaP///wD///8AAAAARQAAANIAAADSAAAARf///wD///8AAAAAaAAAAKsAAACk////AAAAADMAAACcAAAAnQAAABj///8A////AP///wAAAAAYAAAAGP///wD///8A////AAAAABgAAACdAAAAnAAAADMAAAB1AAAAwwAAAP8AAADpAAAAsQAAAE4AAAAb////AP///wAAAAAbAAAATgAAALEAAADpAAAA/wAAAMMAAAB1AAAAtwAAAOkAAAD/AAAA/wAAAP8AAADvAAAA3gAAAN4AAADeAAAA3gAAAO8AAAD/AAAA/wAAAP8AAADpAAAAtwAAAGUAAAA/AAAA3wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAADfAAAAPwAAAGX///8A////AAAAAEgAAADtAAAAvwAAAL0AAADGAAAA7wAAAO8AAADGAAAAvQAAAL8AAADtAAAASP///wD///8A////AP///wD///8AAAAAO////wD///8A////AAAAAIcAAACH////AP///wD///8AAAAAO////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//8AAP//AAD4HwAA7/cAAN/7AAD//wAAoYUAAJ55AACf+QAAh+EAAAAAAADAAwAA4AcAAP5/AAD//wAA//8AAA==">
<link rel="icon" type="image/png" sizes="32x32" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH4QQQEwksSS9ZWwAAAk1JREFUWMPtll2ITVEUx39nn/O7Y5qR8f05wtCUUr6ZIS++8pEnkZInPImneaCQ5METNdOkeFBKUhMPRIkHKfEuUZSUlGlKPN2TrgfncpvmnntnmlEyq1Z7t89/rf9a6+y99oZxGZf/XeIq61EdtgKXgdXA0xrYAvBjOIF1AI9zvjcC74BSpndrJPkBWDScTF8Aa4E3wDlgHbASaANmVqlcCnwHvgDvgVfAJ+AikAAvgfVZwLnSVZHZaOuKoQi3ZOMi4NkYkpe1p4J7A8BpYAD49hfIy/oqG0+hLomiKP2L5L+1ubn5115S+3OAn4EnwBlgMzCjyt6ZAnQCJ4A7wOs88iRJHvw50HoujuPBoCKwHWiosy8MdfZnAdcHk8dxXFJ3VQbQlCTJvRBCGdRbD4M6uc5glpY3eAihpN5S5w12diSEcCCEcKUO4ljdr15T76ur1FDDLIQQ3qv71EdDOe3Kxj3leRXyk+pxdWnFWod6Wt2bY3de3aSuUHcPBVimHs7mK9WrmeOF6lR1o9qnzskh2ar2qm1qizpfXaPeVGdlmGN5pb09qMxz1Xb1kLqgzn1RyH7JUXW52lr5e/Kqi9qpto7V1atuUzfnARrV7jEib1T76gG2qxdGmXyiekkt1GswPTtek0aBfJp6YySGBfWg2tPQ0FAYgf1stUfdmdcjarbYJEniKIq6gY/Aw+zWHAC+p2labGpqiorFYgGYCEzN7oQdQClN07O1/EfDyGgC0ALMBdYAi4FyK+4H3gLPsxfR1zRNi+NP7nH5J+QntnXe5B5mpfQAAAAASUVORK5CYII=">

<!-- Google fonts -->
<link href="https://fonts.googleapis.com/css?family=Lato:400,600,900" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,500,600" rel="stylesheet" type="text/css">

<!-- CSS -->
<title>netkit/buffer/circular</title>
<link rel="stylesheet" type="text/css" href="../../nimdoc.out.css">

<script type="text/javascript" src="/dochack.js"></script>

<script type="text/javascript">
function main() {
  var pragmaDots = document.getElementsByClassName("pragmadots");
  for (var i = 0; i < pragmaDots.length; i++) {
    pragmaDots[i].onclick = function(event) {
      // Hide tease
      event.target.parentNode.style.display = "none";
      // Show actual
      event.target.parentNode.nextElementSibling.style.display = "inline";
    }
  }

  const toggleSwitch = document.querySelector('.theme-switch input[type="checkbox"]');
  function switchTheme(e) {
      if (e.target.checked) {
          document.documentElement.setAttribute('data-theme', 'dark');
          localStorage.setItem('theme', 'dark');
      } else {
          document.documentElement.setAttribute('data-theme', 'light');
          localStorage.setItem('theme', 'light');
      }
  }

  toggleSwitch.addEventListener('change', switchTheme, false);


  if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
    document.documentElement.setAttribute('data-theme', "dark");
    toggleSwitch.checked = true;
  } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) {
    document.documentElement.setAttribute('data-theme', "light");
    toggleSwitch.checked = false;
  } else {
    const currentTheme = localStorage.getItem('theme') ? localStorage.getItem('theme') : null;
    if (currentTheme) {
      document.documentElement.setAttribute('data-theme', currentTheme);

      if (currentTheme === 'dark') {
        toggleSwitch.checked = true;
      }
    }
  }
}
</script>

<style>
    h1 {
      border-bottom: none;
    }
    
    .container h1.title {
      width: 80.0%;
    }
    .container > .row > .columns:first-of-type {
      float: none;
      position: fixed;
      right: 0;
      top: 0;
      width: 18%;
      height: 100%;
      padding-top: 40px;
    }
    .footer {
      width: 80.0%;
    }
    #toc-list {
      height: calc(100% - 169px);
      overflow-y: hidden;
    }
    #toc-list:hover {
      overflow-y: auto;
    }
    #content.columns {
      margin-left: auto;
      margin-left: 1%;
      margin-right: 1%;
    }
  
    pre {
      width: 100%;
      overflow: hidden;
      padding: 0.5em 1em;
    }
    pre:hover {
      overflow: auto;
    }
  
    .pre {
      font-family: Fira Code,Anonymous Pro,Monaco,Menlo,Consolas,Droid Sans Mono,Monospace;
      display: inline-block;
      padding: 0px 0.3em;
      color: #2a6e6b; /*#2a6e6b #4a7e7b*/
      font-weight: bold;
      border-radius: 2px;
      background-color: transparent;
    }

    .r-fragment {
      padding: 0 0 0 30px;
      border-left: 1px solid rgb(216,216,216);
      margin: 40px 0;
    }

    .r-ol {
      padding-left: 1em;
    }

    p {
      margin-top: 20px;
      margin-bottom: 20px;
    }

    img[align=center] {
      display: block;
      margin-left: auto;
      margin-right: auto;
    }
  </style></head>
<body onload="main()">
<div class="document" id="documentId">
  <div class="container">
    <h1 class="title">netkit/buffer/circular</h1>
    <div class="row">
  <div class="three columns">
  <div class="theme-switch-wrapper">
    <label class="theme-switch" for="checkbox">
      <input type="checkbox" id="checkbox">
      <div class="slider round"></div>
    </label>
    &nbsp;&nbsp;&nbsp; <em>Dark Mode</em>
  </div>
  <div id="global-links">
    <ul class="simple">
    </ul>
  </div>
  <div id="searchInputDiv">
    Search: <input type="text" id="searchInput" onkeyup="search()">
  </div>
  <div>
    Group by:
    <select onchange="groupBy(this.value)">
      <option value="section">Section</option>
      <option value="type">Type</option>
    </select>
  </div>
  <ul class="simple simple-toc" id="toc-list">
<li><a class="reference" id="overview_toc" href="#overview">Overview</a></li>
<ul class="simple"><li><a class="reference" id="overview-storage-methods_toc" href="#overview-storage-methods">Storage methods</a></li>
<li><a class="reference" id="overview-marking_toc" href="#overview-marking">Marking</a></li>
<li><a class="reference" id="overview-increment_toc" href="#overview-increment">Increment</a></li>
<li><a class="reference" id="overview-thread-safety_toc" href="#overview-thread-safety">Thread safety</a></li>
</ul><li><a class="reference" id="usage_toc" href="#usage">Usage</a></li>
<ul class="simple"><li><a class="reference" id="usage-manual-storage_toc" href="#usage-manual-storage">Manual storage</a></li>
<li><a class="reference" id="usage-automatic-storage_toc" href="#usage-automatic-storage">Automatic storage</a></li>
<li><a class="reference" id="usage-marking_toc" href="#usage-marking">Marking</a></li>
<li><a class="reference" id="usage-read-data_toc" href="#usage-read-data">Read data</a></li>
</ul><li>
  <a class="reference reference-toplevel" href="#6" id="56">Imports</a>
  <ul class="simple simple-toc-section">
    
  </ul>
</li>
<li>
  <a class="reference reference-toplevel" href="#7" id="57">Types</a>
  <ul class="simple simple-toc-section">
      <li><a class="reference" href="#CircularBuffer" title="CircularBuffer = object of RootObj
  value: array[0 .. BufferSize, byte]
  startPos: Natural
  endPos: Natural
  endMirrorPos: Natural"><wbr>Circular<wbr>Buffer<span class="attachedType"></span></a></li>
  <li><a class="reference" href="#MarkableCircularBuffer" title="MarkableCircularBuffer = object of CircularBuffer
  markedPos: Natural"><wbr>Markable<wbr>Circular<wbr>Buffer<span class="attachedType"></span></a></li>

  </ul>
</li>
<li>
  <a class="reference reference-toplevel" href="#12" id="62">Procs</a>
  <ul class="simple simple-toc-section">
      <li><a class="reference" href="#initCircularBuffer" title="initCircularBuffer(): CircularBuffer"><wbr>init<wbr>Circular<wbr>Buffer<span class="attachedType">CircularBuffer</span></a></li>
  <li><a class="reference" href="#capacity%2CCircularBuffer" title="capacity(b: CircularBuffer): Natural"><wbr>capacity<span class="attachedType">CircularBuffer</span></a></li>
  <li><a class="reference" href="#len%2CCircularBuffer" title="len(b: CircularBuffer): Natural"><wbr>len<span class="attachedType">CircularBuffer</span></a></li>
  <li><a class="reference" href="#next%2CCircularBuffer" title="next(b: var CircularBuffer): (pointer, Natural)"><wbr>next<span class="attachedType">CircularBuffer</span></a></li>
  <li><a class="reference" href="#pack%2CCircularBuffer%2CNatural" title="pack(b: var CircularBuffer; size: Natural): Natural"><wbr>pack<span class="attachedType">CircularBuffer</span></a></li>
  <li><a class="reference" href="#add%2CCircularBuffer%2Cpointer%2CNatural" title="add(b: var CircularBuffer; source: pointer; size: Natural): Natural"><wbr>add<span class="attachedType">CircularBuffer</span></a></li>
  <li><a class="reference" href="#add%2CCircularBuffer%2Cchar" title="add(b: var CircularBuffer; c: char): Natural"><wbr>add<span class="attachedType">CircularBuffer</span></a></li>
  <li><a class="reference" href="#get%2CCircularBuffer%2Cpointer%2CNatural" title="get(b: var CircularBuffer; dest: pointer; size: Natural): Natural"><wbr>get<span class="attachedType">CircularBuffer</span></a></li>
  <li><a class="reference" href="#get%2CCircularBuffer%2CNatural" title="get(b: var CircularBuffer; size: Natural): string"><wbr>get<span class="attachedType">CircularBuffer</span></a></li>
  <li><a class="reference" href="#get%2CCircularBuffer" title="get(b: var CircularBuffer): string"><wbr>get<span class="attachedType">CircularBuffer</span></a></li>
  <li><a class="reference" href="#del%2CCircularBuffer%2CNatural" title="del(b: var CircularBuffer; size: Natural): Natural"><wbr>del<span class="attachedType">CircularBuffer</span></a></li>
  <li><a class="reference" href="#initMarkableCircularBuffer" title="initMarkableCircularBuffer(): MarkableCircularBuffer"><wbr>init<wbr>Markable<wbr>Circular<wbr>Buffer<span class="attachedType">MarkableCircularBuffer</span></a></li>
  <li><a class="reference" href="#del%2CMarkableCircularBuffer%2CNatural" title="del(b: var MarkableCircularBuffer; size: Natural): Natural"><wbr>del<span class="attachedType">MarkableCircularBuffer</span></a></li>
  <li><a class="reference" href="#mark%2CMarkableCircularBuffer%2CNatural" title="mark(b: var MarkableCircularBuffer; size: Natural): Natural"><wbr>mark<span class="attachedType">MarkableCircularBuffer</span></a></li>
  <li><a class="reference" href="#markUntil%2CMarkableCircularBuffer%2Cchar" title="markUntil(b: var MarkableCircularBuffer; c: char): bool"><wbr>mark<wbr>Until<span class="attachedType">MarkableCircularBuffer</span></a></li>
  <li><a class="reference" href="#markAll%2CMarkableCircularBuffer" title="markAll(b: var MarkableCircularBuffer)"><wbr>mark<wbr>All<span class="attachedType">MarkableCircularBuffer</span></a></li>
  <li><a class="reference" href="#lenMarks%2CMarkableCircularBuffer" title="lenMarks(b: MarkableCircularBuffer): Natural"><wbr>len<wbr>Marks<span class="attachedType">MarkableCircularBuffer</span></a></li>
  <li><a class="reference" href="#popMarks%2CMarkableCircularBuffer%2CNatural" title="popMarks(b: var MarkableCircularBuffer; n: Natural = 0): string"><wbr>pop<wbr>Marks<span class="attachedType">MarkableCircularBuffer</span></a></li>

  </ul>
</li>
<li>
  <a class="reference reference-toplevel" href="#15" id="65">Iterators</a>
  <ul class="simple simple-toc-section">
      <li><a class="reference" href="#items.i%2CCircularBuffer" title="items(b: CircularBuffer): char"><wbr>items<span class="attachedType">CircularBuffer</span></a></li>
  <li><a class="reference" href="#marks.i%2CMarkableCircularBuffer" title="marks(b: var MarkableCircularBuffer): char"><wbr>marks<span class="attachedType">MarkableCircularBuffer</span></a></li>

  </ul>
</li>

</ul>

  </div>
  <div class="nine columns" id="content">
  <div id="tocRoot"></div>
  
  <p class="module-desc">This module implements a circular buffer <tt class="docutils literal"><span class="pre">CircularBuffer</span></tt> and a markable circular buffer <tt class="docutils literal"><span class="pre">MarkableCircularBuffer</span></tt> that supports incremental marking.
</p><h1><a class="toc-backref" id="overview" href="#overview">Overview</a></h1><p><tt class="docutils literal"><span class="pre">CircularBuffer</span></tt> uses a fixed-length array as a storage container, and the two ends of the array are connected together. It does not need to have its elements shuffled around when one is consumed. This lends itself easily to buffering data streams.</p>
<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b7/Circular_buffer.svg/400px-Circular_buffer.svg.png" align="center"><p>At a certain moment, its storage state is similar to:</p>
<pre class="listing"><span class="Punctuation">[</span>   <span class="Identifier">empty</span>   <span class="Operator">|---</span><span class="Identifier">data</span><span class="Operator">---|</span>   <span class="Identifier">empty</span>  <span class="Punctuation">]</span></pre><ul class="simple"><li>see <a class="reference external" href="https://en.wikipedia.org/wiki/Circular_buffer">Circular buffer Wiki</a></li>
<li>see <a class="reference external" href="https://zh.wikipedia.org/wiki/%E7%92%B0%E5%BD%A2%E7%B7%A9%E8%A1%9D%E5%8D%80">Circular buffer Wiki 中文</a></li>
</ul>
<p><tt class="docutils literal"><span class="pre">MarkableCircularBuffer</span></tt> inherits from <tt class="docutils literal"><span class="pre">CircularBuffer</span></tt> , and adds the function of incremental marking, allowing the data stored to be marked. Increment means that the next operation will always continue from the previous end position.  Incremental marking simplifies some tedious tasks such as scanning, analysis and so on.</p>
<div class="r-fragment">
<h2><a class="toc-backref" id="overview-storage-methods" href="#overview-storage-methods">Storage methods</a></h2><p>The circular buffer provides two storage methods: manual storage and automatic storage.</p>
<p>Manual storage is a low-level operation, which can obtain better performance but is more complicated. You need to directly manipulate the storable space involved in <tt class="docutils literal"><span class="pre">next</span></tt> and <tt class="docutils literal"><span class="pre">pack</span></tt>, and use <tt class="docutils literal"><span class="pre">copyMem</span></tt>, <tt class="docutils literal"><span class="pre">read(file, pointer, size)</span></tt> or other similar methods to directly store data. This is an unsafe method, but there is no  additional copy, so you can get better performance.</p>
<p>Automatic storage is a high-level operation, storing data with <tt class="docutils literal"><span class="pre">add</span></tt>. This is a safer and simpler method, but it has additional copy overhead.</p>
</div><div class="r-fragment">
<h2><a class="toc-backref" id="overview-marking" href="#overview-marking">Marking</a></h2><p><tt class="docutils literal"><span class="pre">MarkableCircularBuffer</span></tt> allows marking data. <tt class="docutils literal"><span class="pre">marks()</span></tt> iterates the stored data one by one in the form of characters (bytes), and marks the characters (bytes) at the same time. This is especially useful for data analysis, such as searching a CRLF. When you find the desired mark, you can use <tt class="docutils literal"><span class="pre">popMarks</span></tt> to extract the marked data.</p>
</div><div class="r-fragment">
<h2><a class="toc-backref" id="overview-increment" href="#overview-increment">Increment</a></h2><p>In most IO scenarios, you need to read or write data repeatedly. <tt class="docutils literal"><span class="pre">MarkableCircularBuffer</span></tt> provides incremental support for this  environment, incrementally storing data and incrementally marking data, so that you don't have to worry about losing data state in a loop operation.</p>
</div><div class="r-fragment">
<h2><a class="toc-backref" id="overview-thread-safety" href="#overview-thread-safety">Thread safety</a></h2><p><tt class="docutils literal"><span class="pre">CircularBuffer</span></tt> and <tt class="docutils literal"><span class="pre">MarkableCircularBuffer</span></tt> does not guarantees thread safety. When you use them in multiple threads, you should be responsible for conditional competition.</p>
</div>
<h1><a class="toc-backref" id="usage" href="#usage">Usage</a></h1><div class="r-fragment">
<h2><a class="toc-backref" id="usage-manual-storage" href="#usage-manual-storage">Manual storage</a></h2><p>Manual storage can be divided into three steps:</p>
<p>1. Gets the address and the length of a storable space：</p>
<pre class="listing"><span class="Keyword">var</span> <span class="Identifier">buffer</span> <span class="Operator">=</span> <span class="Identifier">initMarkableCircularBuffer</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
<span class="Keyword">var</span> <span class="Punctuation">(</span><span class="Identifier">regionPtr</span><span class="Punctuation">,</span> <span class="Identifier">regionLen</span><span class="Punctuation">)</span> <span class="Operator">=</span> <span class="Identifier">buffer</span><span class="Operator">.</span><span class="Identifier">next</span><span class="Punctuation">(</span><span class="Punctuation">)</span></pre><p>2. Operates the storable space to store data：</p>
<pre class="listing"><span class="Keyword">var</span> <span class="Identifier">readLen</span> <span class="Operator">=</span> <span class="Identifier">socket</span><span class="Operator">.</span><span class="Identifier">read</span><span class="Punctuation">(</span><span class="Identifier">regionPtr</span><span class="Punctuation">,</span> <span class="Identifier">regionLen</span><span class="Punctuation">)</span></pre><p>3. Tell the buffer the length of the stored data：</p>
<pre class="listing"><span class="Keyword">var</span> <span class="Identifier">packLen</span> <span class="Operator">=</span> <span class="Identifier">buffer</span><span class="Operator">.</span><span class="Identifier">pack</span><span class="Punctuation">(</span><span class="Identifier">n</span><span class="Punctuation">)</span></pre></div><div class="r-fragment">
<h2><a class="toc-backref" id="usage-automatic-storage" href="#usage-automatic-storage">Automatic storage</a></h2><p>To store a character:</p>
<pre class="listing"><span class="Keyword">var</span> <span class="Identifier">n</span> <span class="Operator">=</span> <span class="Identifier">buffer</span><span class="Operator">.</span><span class="Identifier">add</span><span class="Punctuation">(</span><span class="CharLit">'A'</span><span class="Punctuation">)</span></pre><p>To store a string:</p>
<pre class="listing"><span class="Keyword">var</span> <span class="Identifier">str</span> <span class="Operator">=</span> <span class="StringLit">"ABC"</span>
<span class="Keyword">var</span> <span class="Identifier">n</span> <span class="Operator">=</span> <span class="Identifier">buffer</span><span class="Operator">.</span><span class="Identifier">add</span><span class="Punctuation">(</span><span class="Identifier">str</span><span class="Operator">.</span><span class="Identifier">cstring</span><span class="Punctuation">,</span> <span class="DecNumber">3</span><span class="Punctuation">)</span></pre></div><div class="r-fragment">
<h2><a class="toc-backref" id="usage-marking" href="#usage-marking">Marking</a></h2><p>To search a string ending with a newline character:</p>
<pre class="listing"><span class="Keyword">var</span> <span class="Identifier">buffer</span> <span class="Operator">=</span> <span class="Identifier">initMarkableCircularBuffer</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
<span class="Keyword">var</span> <span class="Identifier">str</span> <span class="Operator">=</span> <span class="StringLit">"foo</span><span class="EscapeSequence">\L</span><span class="EscapeSequence">bar\L</span><span class="StringLit">"</span>
<span class="Identifier">assert</span> <span class="Identifier">buffer</span><span class="Operator">.</span><span class="Identifier">add</span><span class="Punctuation">(</span><span class="Identifier">str</span><span class="Operator">.</span><span class="Identifier">cstring</span><span class="Punctuation">,</span> <span class="Identifier">str</span><span class="Operator">.</span><span class="Identifier">len</span><span class="Punctuation">)</span> <span class="Operator">==</span> <span class="Identifier">str</span><span class="Operator">.</span><span class="Identifier">len</span>

<span class="Keyword">var</span> <span class="Identifier">lineString</span> <span class="Operator">=</span> <span class="StringLit">""</span>

<span class="Keyword">for</span> <span class="Identifier">c</span> <span class="Keyword">in</span> <span class="Identifier">buffer</span><span class="Operator">.</span><span class="Identifier">marks</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span>
  <span class="Keyword">if</span> <span class="Identifier">c</span> <span class="Operator">==</span> <span class="CharLit">'\L'</span><span class="Punctuation">:</span>
    <span class="Identifier">lineString</span> <span class="Operator">=</span> <span class="Identifier">buffer</span><span class="Operator">.</span><span class="Identifier">popMarks</span><span class="Punctuation">(</span><span class="DecNumber">1</span><span class="Punctuation">)</span>
    <span class="Keyword">break</span>
<span class="Identifier">assert</span> <span class="Identifier">lineString</span> <span class="Operator">==</span> <span class="StringLit">"foo"</span>

<span class="Keyword">for</span> <span class="Identifier">c</span> <span class="Keyword">in</span> <span class="Identifier">buffer</span><span class="Operator">.</span><span class="Identifier">marks</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span>
  <span class="Keyword">if</span> <span class="Identifier">c</span> <span class="Operator">==</span> <span class="CharLit">'\L'</span><span class="Punctuation">:</span>
    <span class="Identifier">lineString</span> <span class="Operator">=</span> <span class="Identifier">buffer</span><span class="Operator">.</span><span class="Identifier">popMarks</span><span class="Punctuation">(</span><span class="DecNumber">1</span><span class="Punctuation">)</span>
    <span class="Keyword">break</span>
<span class="Identifier">assert</span> <span class="Identifier">lineString</span> <span class="Operator">==</span> <span class="StringLit">"bar"</span></pre><p><tt class="docutils literal"><span class="pre">markUntil</span></tt> makes this process easier:</p>
<pre class="listing"><span class="Keyword">var</span> <span class="Identifier">buffer</span> <span class="Operator">=</span> <span class="Identifier">initMarkableCircularBuffer</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
<span class="Keyword">var</span> <span class="Identifier">str</span> <span class="Operator">=</span> <span class="StringLit">"foo</span><span class="EscapeSequence">\L</span><span class="EscapeSequence">bar\L</span><span class="StringLit">"</span>
<span class="Identifier">assert</span> <span class="Identifier">buffer</span><span class="Operator">.</span><span class="Identifier">add</span><span class="Punctuation">(</span><span class="Identifier">str</span><span class="Operator">.</span><span class="Identifier">cstring</span><span class="Punctuation">,</span> <span class="Identifier">str</span><span class="Operator">.</span><span class="Identifier">len</span><span class="Punctuation">)</span> <span class="Operator">==</span> <span class="Identifier">str</span><span class="Operator">.</span><span class="Identifier">len</span>

<span class="Keyword">var</span> <span class="Identifier">lineString</span> <span class="Operator">=</span> <span class="StringLit">""</span>

<span class="Identifier">assert</span> <span class="Identifier">buffer</span><span class="Operator">.</span><span class="Identifier">markUntil</span><span class="Punctuation">(</span><span class="CharLit">'\L'</span><span class="Punctuation">)</span>
<span class="Identifier">assert</span> <span class="Identifier">lineString</span> <span class="Operator">==</span> <span class="StringLit">"foo"</span>

<span class="Identifier">assert</span> <span class="Identifier">buffer</span><span class="Operator">.</span><span class="Identifier">markUntil</span><span class="Punctuation">(</span><span class="CharLit">'\L'</span><span class="Punctuation">)</span>
<span class="Identifier">assert</span> <span class="Identifier">lineString</span> <span class="Operator">==</span> <span class="StringLit">"bar"</span></pre></div><div class="r-fragment">
<h2><a class="toc-backref" id="usage-read-data" href="#usage-read-data">Read data</a></h2><p>Copy the stored data to a specified memory and delete the data:</p>
<pre class="listing"><span class="Keyword">var</span> <span class="Identifier">buffer</span> <span class="Operator">=</span> <span class="Identifier">initMarkableCircularBuffer</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
<span class="Keyword">var</span> <span class="Identifier">str</span> <span class="Operator">=</span> <span class="StringLit">"foo</span><span class="EscapeSequence">\L</span><span class="EscapeSequence">bar\L</span><span class="StringLit">"</span>
<span class="Identifier">assert</span> <span class="Identifier">buffer</span><span class="Operator">.</span><span class="Identifier">add</span><span class="Punctuation">(</span><span class="Identifier">str</span><span class="Operator">.</span><span class="Identifier">cstring</span><span class="Punctuation">,</span> <span class="Identifier">str</span><span class="Operator">.</span><span class="Identifier">len</span><span class="Punctuation">)</span> <span class="Operator">==</span> <span class="Identifier">str</span><span class="Operator">.</span><span class="Identifier">len</span>
<span class="Identifier">assert</span> <span class="Identifier">buffer</span><span class="Operator">.</span><span class="Identifier">len</span> <span class="Operator">==</span> <span class="Identifier">str</span><span class="Operator">.</span><span class="Identifier">len</span>

<span class="Keyword">var</span> <span class="Identifier">dest</span> <span class="Operator">=</span> <span class="Identifier">newString</span><span class="Punctuation">(</span><span class="DecNumber">64</span><span class="Punctuation">)</span>
<span class="Keyword">var</span> <span class="Identifier">getLen</span> <span class="Operator">=</span> <span class="Identifier">buffer</span><span class="Operator">.</span><span class="Identifier">get</span><span class="Punctuation">(</span><span class="Identifier">dest</span><span class="Punctuation">,</span> <span class="Identifier">destLen</span><span class="Punctuation">)</span>
<span class="Keyword">var</span> <span class="Identifier">delLen</span> <span class="Operator">=</span> <span class="Identifier">buffer</span><span class="Operator">.</span><span class="Identifier">del</span><span class="Punctuation">(</span><span class="Identifier">getLen</span><span class="Punctuation">)</span>
<span class="Identifier">dest</span><span class="Operator">.</span><span class="Identifier">setLen</span><span class="Punctuation">(</span><span class="Identifier">getLen</span><span class="Punctuation">)</span>

<span class="Identifier">assert</span> <span class="Identifier">dest</span> <span class="Operator">==</span> <span class="StringLit">"foo</span><span class="EscapeSequence">\L</span><span class="EscapeSequence">bar\L</span><span class="StringLit">"</span>
<span class="Identifier">assert</span> <span class="Identifier">buffer</span><span class="Operator">.</span><span class="Identifier">len</span> <span class="Operator">==</span> <span class="DecNumber">0</span></pre><p>Copy the stored data to a string and delete the data:</p>
<pre class="listing"><span class="Keyword">var</span> <span class="Identifier">buffer</span> <span class="Operator">=</span> <span class="Identifier">initMarkableCircularBuffer</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
<span class="Keyword">var</span> <span class="Identifier">str</span> <span class="Operator">=</span> <span class="StringLit">"foo</span><span class="EscapeSequence">\L</span><span class="EscapeSequence">bar\L</span><span class="StringLit">"</span>
<span class="Identifier">assert</span> <span class="Identifier">buffer</span><span class="Operator">.</span><span class="Identifier">add</span><span class="Punctuation">(</span><span class="Identifier">str</span><span class="Operator">.</span><span class="Identifier">cstring</span><span class="Punctuation">,</span> <span class="Identifier">str</span><span class="Operator">.</span><span class="Identifier">len</span><span class="Punctuation">)</span> <span class="Operator">==</span> <span class="Identifier">str</span><span class="Operator">.</span><span class="Identifier">len</span>
<span class="Identifier">assert</span> <span class="Identifier">buffer</span><span class="Operator">.</span><span class="Identifier">len</span> <span class="Operator">==</span> <span class="Identifier">str</span><span class="Operator">.</span><span class="Identifier">len</span>

<span class="Keyword">var</span> <span class="Identifier">foo</span> <span class="Operator">=</span> <span class="Identifier">buffer</span><span class="Operator">.</span><span class="Identifier">get</span><span class="Punctuation">(</span><span class="DecNumber">3</span><span class="Punctuation">)</span>
<span class="Identifier">assert</span> <span class="Identifier">foo</span> <span class="Operator">==</span> <span class="StringLit">"foo"</span></pre></div><p></p>
  <div class="section" id="6">
<h1><a class="toc-backref" href="#6">Imports</a></h1>
<dl class="item">
<a class="reference external" href="../misc.html">../misc</a>, <a class="reference external" href="constants.html">constants</a>
</dl></div>
<div class="section" id="7">
<h1><a class="toc-backref" href="#7">Types</a></h1>
<dl class="item">
<a id="CircularBuffer"></a>
<dt><pre><a href="circular.html#CircularBuffer"><span class="Identifier">CircularBuffer</span></a> <span class="Other">=</span> <span class="Keyword">object</span> <span class="Keyword">of</span> <span class="Identifier">RootObj</span>
  <span class="Identifier">value</span><span class="Other">:</span> <span class="Identifier">array</span><span class="Other">[</span><span class="DecNumber">0</span> <span class="Operator">..</span> <span class="Identifier">BufferSize</span><span class="Other">,</span> <span class="Identifier">byte</span><span class="Other">]</span>
  <span class="Identifier">startPos</span><span class="Other">:</span> <span class="Identifier">Natural</span>
  <span class="Identifier">endPos</span><span class="Other">:</span> <span class="Identifier">Natural</span>
  <span class="Identifier">endMirrorPos</span><span class="Other">:</span> <span class="Identifier">Natural</span>
</pre></dt>
<dd>

A circular buffer. Note that the maximum length of its storage space is <tt class="docutils literal"><span class="pre">BufferSize</span></tt>.
&nbsp;&nbsp;<a href="https://github.com/iocrate/netkit/tree/master/netkit/buffer/circular.nim#L202" class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/iocrate/netkit/edit/devel/netkit/buffer/circular.nim#L202" class="link-seesrc" target="_blank">Edit</a>

</dd>
<a id="MarkableCircularBuffer"></a>
<dt><pre><a href="circular.html#MarkableCircularBuffer"><span class="Identifier">MarkableCircularBuffer</span></a> <span class="Other">=</span> <span class="Keyword">object</span> <span class="Keyword">of</span> <a href="circular.html#CircularBuffer"><span class="Identifier">CircularBuffer</span></a>
  <span class="Identifier">markedPos</span><span class="Other">:</span> <span class="Identifier">Natural</span>
</pre></dt>
<dd>

A markable circular buffer.
&nbsp;&nbsp;<a href="https://github.com/iocrate/netkit/tree/master/netkit/buffer/circular.nim#L209" class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/iocrate/netkit/edit/devel/netkit/buffer/circular.nim#L209" class="link-seesrc" target="_blank">Edit</a>

</dd>

</dl></div>
<div class="section" id="12">
<h1><a class="toc-backref" href="#12">Procs</a></h1>
<dl class="item">
<a id="initCircularBuffer"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#initCircularBuffer"><span class="Identifier">initCircularBuffer</span></a><span class="Other">(</span><span class="Other">)</span><span class="Other">:</span> <a href="circular.html#CircularBuffer"><span class="Identifier">CircularBuffer</span></a> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Initializes an <tt class="docutils literal"><span class="pre">CircularBuffer</span></tt>. 
&nbsp;&nbsp;<a href="https://github.com/iocrate/netkit/tree/master/netkit/buffer/circular.nim#L213" class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/iocrate/netkit/edit/devel/netkit/buffer/circular.nim#L213" class="link-seesrc" target="_blank">Edit</a>

</dd>
<a id="capacity,CircularBuffer"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#capacity%2CCircularBuffer"><span class="Identifier">capacity</span></a><span class="Other">(</span><span class="Identifier">b</span><span class="Other">:</span> <a href="circular.html#CircularBuffer"><span class="Identifier">CircularBuffer</span></a><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">Natural</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">inline</span><span class="Other">,</span> <span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Returns the capacity of this buffer.
&nbsp;&nbsp;<a href="https://github.com/iocrate/netkit/tree/master/netkit/buffer/circular.nim#L217" class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/iocrate/netkit/edit/devel/netkit/buffer/circular.nim#L217" class="link-seesrc" target="_blank">Edit</a>

</dd>
<a id="len,CircularBuffer"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#len%2CCircularBuffer"><span class="Identifier">len</span></a><span class="Other">(</span><span class="Identifier">b</span><span class="Other">:</span> <a href="circular.html#CircularBuffer"><span class="Identifier">CircularBuffer</span></a><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">Natural</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">inline</span><span class="Other">,</span> <span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Returns the length of the data stored in this buffer.
&nbsp;&nbsp;<a href="https://github.com/iocrate/netkit/tree/master/netkit/buffer/circular.nim#L221" class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/iocrate/netkit/edit/devel/netkit/buffer/circular.nim#L221" class="link-seesrc" target="_blank">Edit</a>

</dd>
<a id="next,CircularBuffer"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#next%2CCircularBuffer"><span class="Identifier">next</span></a><span class="Other">(</span><span class="Identifier">b</span><span class="Other">:</span> <span class="Keyword">var</span> <a href="circular.html#CircularBuffer"><span class="Identifier">CircularBuffer</span></a><span class="Other">)</span><span class="Other">:</span> <span class="Other">(</span><span class="Identifier">pointer</span><span class="Other">,</span> <span class="Identifier">Natural</span><span class="Other">)</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

<p>Gets the next safe storage space. The return value includes the address and length of the storable space.</p>
<p>Examples:</p>
<pre class="listing"><span class="Keyword">var</span> <span class="Identifier">source</span> <span class="Operator">=</span> <span class="StringLit">"Hello World"</span>
<span class="Keyword">var</span> <span class="Punctuation">(</span><span class="Identifier">regionPtr</span><span class="Punctuation">,</span> <span class="Identifier">regionLen</span><span class="Punctuation">)</span> <span class="Operator">=</span> <span class="Identifier">buffer</span><span class="Operator">.</span><span class="Identifier">next</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
<span class="Keyword">var</span> <span class="Identifier">length</span> <span class="Operator">=</span> <span class="Identifier">min</span><span class="Punctuation">(</span><span class="Identifier">regionLen</span><span class="Punctuation">,</span> <span class="Identifier">s</span><span class="Operator">.</span><span class="Identifier">len</span><span class="Punctuation">)</span>
<span class="Identifier">copyMem</span><span class="Punctuation">(</span><span class="Identifier">regionPtr</span><span class="Punctuation">,</span> <span class="Identifier">source</span><span class="Operator">.</span><span class="Identifier">cstring</span><span class="Punctuation">,</span> <span class="Identifier">length</span><span class="Punctuation">)</span> </pre>
&nbsp;&nbsp;<a href="https://github.com/iocrate/netkit/tree/master/netkit/buffer/circular.nim#L225" class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/iocrate/netkit/edit/devel/netkit/buffer/circular.nim#L225" class="link-seesrc" target="_blank">Edit</a>

</dd>
<a id="pack,CircularBuffer,Natural"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#pack%2CCircularBuffer%2CNatural"><span class="Identifier">pack</span></a><span class="Other">(</span><span class="Identifier">b</span><span class="Other">:</span> <span class="Keyword">var</span> <a href="circular.html#CircularBuffer"><span class="Identifier">CircularBuffer</span></a><span class="Other">;</span> <span class="Identifier">size</span><span class="Other">:</span> <span class="Identifier">Natural</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">Natural</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

<p>Tells the buffer that <tt class="docutils literal"><span class="pre">size</span></tt> bytes from the current storage location are promoted to data. Returns the actual length promoted.</p>
<p>When <tt class="docutils literal"><span class="pre">next()</span></tt> is called, data is written to the storage space inside the buffer, but the buffer cannot know how much data was written. <tt class="docutils literal"><span class="pre">pack ()</span></tt> tells the buffer the length of the data written.</p>
<p>Whenever <tt class="docutils literal"><span class="pre">next()</span></tt> is called, <tt class="docutils literal"><span class="pre">pack()</span></tt> should be called immediately.</p>
<p>Examples:</p>
<pre class="listing"><span class="Keyword">var</span> <span class="Identifier">source</span> <span class="Operator">=</span> <span class="StringLit">"Hello World"</span>
<span class="Keyword">var</span> <span class="Punctuation">(</span><span class="Identifier">regionPtr</span><span class="Punctuation">,</span> <span class="Identifier">regionLen</span><span class="Punctuation">)</span> <span class="Operator">=</span> <span class="Identifier">buffer</span><span class="Operator">.</span><span class="Identifier">next</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
<span class="Keyword">var</span> <span class="Identifier">length</span> <span class="Operator">=</span> <span class="Identifier">min</span><span class="Punctuation">(</span><span class="Identifier">regionLen</span><span class="Punctuation">,</span> <span class="Identifier">s</span><span class="Operator">.</span><span class="Identifier">len</span><span class="Punctuation">)</span>
<span class="Identifier">copyMem</span><span class="Punctuation">(</span><span class="Identifier">regionPtr</span><span class="Punctuation">,</span> <span class="Identifier">source</span><span class="Operator">.</span><span class="Identifier">cstring</span><span class="Punctuation">,</span> <span class="Identifier">length</span><span class="Punctuation">)</span>
<span class="Keyword">var</span> <span class="Identifier">n</span> <span class="Operator">=</span> <span class="Identifier">buffer</span><span class="Operator">.</span><span class="Identifier">pack</span><span class="Punctuation">(</span><span class="Identifier">length</span><span class="Punctuation">)</span></pre>
&nbsp;&nbsp;<a href="https://github.com/iocrate/netkit/tree/master/netkit/buffer/circular.nim#L241" class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/iocrate/netkit/edit/devel/netkit/buffer/circular.nim#L241" class="link-seesrc" target="_blank">Edit</a>

</dd>
<a id="add,CircularBuffer,pointer,Natural"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#add%2CCircularBuffer%2Cpointer%2CNatural"><span class="Identifier">add</span></a><span class="Other">(</span><span class="Identifier">b</span><span class="Other">:</span> <span class="Keyword">var</span> <a href="circular.html#CircularBuffer"><span class="Identifier">CircularBuffer</span></a><span class="Other">;</span> <span class="Identifier">source</span><span class="Other">:</span> <span class="Identifier">pointer</span><span class="Other">;</span> <span class="Identifier">size</span><span class="Other">:</span> <span class="Identifier">Natural</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">Natural</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span>
    <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

<p>Copies up to <tt class="docutils literal"><span class="pre">size</span></tt> lengths of data from <tt class="docutils literal"><span class="pre">source</span></tt> and store the data in the buffer. Returns the actual length copied. This is a simplified version of the <tt class="docutils literal"><span class="pre">next</span></tt> <tt class="docutils literal"><span class="pre">pack</span></tt> combination call. The difference is that an additional copy operation is made instead of writing directly to the buffer.</p>
<p>Examples:</p>
<pre class="listing"><span class="Keyword">var</span> <span class="Identifier">source</span> <span class="Operator">=</span> <span class="StringLit">"Hello World"</span>
<span class="Keyword">var</span> <span class="Identifier">n</span> <span class="Operator">=</span> <span class="Identifier">buffer</span><span class="Operator">.</span><span class="Identifier">add</span><span class="Punctuation">(</span><span class="Identifier">source</span><span class="Operator">.</span><span class="Identifier">cstring</span><span class="Punctuation">,</span> <span class="Identifier">source</span><span class="Operator">.</span><span class="Identifier">len</span><span class="Punctuation">)</span></pre>
&nbsp;&nbsp;<a href="https://github.com/iocrate/netkit/tree/master/netkit/buffer/circular.nim#L268" class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/iocrate/netkit/edit/devel/netkit/buffer/circular.nim#L268" class="link-seesrc" target="_blank">Edit</a>

</dd>
<a id="add,CircularBuffer,char"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#add%2CCircularBuffer%2Cchar"><span class="Identifier">add</span></a><span class="Other">(</span><span class="Identifier">b</span><span class="Other">:</span> <span class="Keyword">var</span> <a href="circular.html#CircularBuffer"><span class="Identifier">CircularBuffer</span></a><span class="Other">;</span> <span class="Identifier">c</span><span class="Other">:</span> <span class="Identifier">char</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">Natural</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Stores a character <tt class="docutils literal"><span class="pre">c</span></tt> in the buffer and returns the actual stored length. If the storage space is full, it will return <tt class="docutils literal"><span class="pre">0</span></tt>, otherwise <tt class="docutils literal"><span class="pre">1</span></tt>.
&nbsp;&nbsp;<a href="https://github.com/iocrate/netkit/tree/master/netkit/buffer/circular.nim#L292" class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/iocrate/netkit/edit/devel/netkit/buffer/circular.nim#L292" class="link-seesrc" target="_blank">Edit</a>

</dd>
<a id="get,CircularBuffer,pointer,Natural"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#get%2CCircularBuffer%2Cpointer%2CNatural"><span class="Identifier">get</span></a><span class="Other">(</span><span class="Identifier">b</span><span class="Other">:</span> <span class="Keyword">var</span> <a href="circular.html#CircularBuffer"><span class="Identifier">CircularBuffer</span></a><span class="Other">;</span> <span class="Identifier">dest</span><span class="Other">:</span> <span class="Identifier">pointer</span><span class="Other">;</span> <span class="Identifier">size</span><span class="Other">:</span> <span class="Identifier">Natural</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">Natural</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span>
    <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Gets up to <tt class="docutils literal"><span class="pre">size</span></tt> of the stored data, and copy the data to the space <tt class="docutils literal"><span class="pre">dest</span></tt>. Returns the actual number copied.
&nbsp;&nbsp;<a href="https://github.com/iocrate/netkit/tree/master/netkit/buffer/circular.nim#L301" class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/iocrate/netkit/edit/devel/netkit/buffer/circular.nim#L301" class="link-seesrc" target="_blank">Edit</a>

</dd>
<a id="get,CircularBuffer,Natural"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#get%2CCircularBuffer%2CNatural"><span class="Identifier">get</span></a><span class="Other">(</span><span class="Identifier">b</span><span class="Other">:</span> <span class="Keyword">var</span> <a href="circular.html#CircularBuffer"><span class="Identifier">CircularBuffer</span></a><span class="Other">;</span> <span class="Identifier">size</span><span class="Other">:</span> <span class="Identifier">Natural</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">string</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Gets up to <tt class="docutils literal"><span class="pre">size</span></tt> of the  stored data and returns as a string. 
&nbsp;&nbsp;<a href="https://github.com/iocrate/netkit/tree/master/netkit/buffer/circular.nim#L311" class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/iocrate/netkit/edit/devel/netkit/buffer/circular.nim#L311" class="link-seesrc" target="_blank">Edit</a>

</dd>
<a id="get,CircularBuffer"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#get%2CCircularBuffer"><span class="Identifier">get</span></a><span class="Other">(</span><span class="Identifier">b</span><span class="Other">:</span> <span class="Keyword">var</span> <a href="circular.html#CircularBuffer"><span class="Identifier">CircularBuffer</span></a><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">string</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Gets all stored data and returns as a string.
&nbsp;&nbsp;<a href="https://github.com/iocrate/netkit/tree/master/netkit/buffer/circular.nim#L317" class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/iocrate/netkit/edit/devel/netkit/buffer/circular.nim#L317" class="link-seesrc" target="_blank">Edit</a>

</dd>
<a id="del,CircularBuffer,Natural"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#del%2CCircularBuffer%2CNatural"><span class="Identifier">del</span></a><span class="Other">(</span><span class="Identifier">b</span><span class="Other">:</span> <span class="Keyword">var</span> <a href="circular.html#CircularBuffer"><span class="Identifier">CircularBuffer</span></a><span class="Other">;</span> <span class="Identifier">size</span><span class="Other">:</span> <span class="Identifier">Natural</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">Natural</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Deletes up to <tt class="docutils literal"><span class="pre">size</span></tt> of the stored data and returns the actual number deleted.
&nbsp;&nbsp;<a href="https://github.com/iocrate/netkit/tree/master/netkit/buffer/circular.nim#L321" class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/iocrate/netkit/edit/devel/netkit/buffer/circular.nim#L321" class="link-seesrc" target="_blank">Edit</a>

</dd>
<a id="initMarkableCircularBuffer"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#initMarkableCircularBuffer"><span class="Identifier">initMarkableCircularBuffer</span></a><span class="Other">(</span><span class="Other">)</span><span class="Other">:</span> <a href="circular.html#MarkableCircularBuffer"><span class="Identifier">MarkableCircularBuffer</span></a> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Initializes an <tt class="docutils literal"><span class="pre">MarkableCircularBuffer</span></tt>. 
&nbsp;&nbsp;<a href="https://github.com/iocrate/netkit/tree/master/netkit/buffer/circular.nim#L346" class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/iocrate/netkit/edit/devel/netkit/buffer/circular.nim#L346" class="link-seesrc" target="_blank">Edit</a>

</dd>
<a id="del,MarkableCircularBuffer,Natural"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#del%2CMarkableCircularBuffer%2CNatural"><span class="Identifier">del</span></a><span class="Other">(</span><span class="Identifier">b</span><span class="Other">:</span> <span class="Keyword">var</span> <a href="circular.html#MarkableCircularBuffer"><span class="Identifier">MarkableCircularBuffer</span></a><span class="Other">;</span> <span class="Identifier">size</span><span class="Other">:</span> <span class="Identifier">Natural</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">Natural</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Deletes up to <tt class="docutils literal"><span class="pre">size</span></tt> of the stored data and returns the actual number deleted.
&nbsp;&nbsp;<a href="https://github.com/iocrate/netkit/tree/master/netkit/buffer/circular.nim#L350" class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/iocrate/netkit/edit/devel/netkit/buffer/circular.nim#L350" class="link-seesrc" target="_blank">Edit</a>

</dd>
<a id="mark,MarkableCircularBuffer,Natural"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#mark%2CMarkableCircularBuffer%2CNatural"><span class="Identifier">mark</span></a><span class="Other">(</span><span class="Identifier">b</span><span class="Other">:</span> <span class="Keyword">var</span> <a href="circular.html#MarkableCircularBuffer"><span class="Identifier">MarkableCircularBuffer</span></a><span class="Other">;</span> <span class="Identifier">size</span><span class="Other">:</span> <span class="Identifier">Natural</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">Natural</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

<p>Marks the stored data in the buffer immediately until it reaches <tt class="docutils literal"><span class="pre">size</span></tt> or reaches the end of the data. Returns the actual number marked.</p>
<p>Note that the marking is performed incrementally, that is, when the marking operation is called next time, it will continue from the position where it last ended.</p>

&nbsp;&nbsp;<a href="https://github.com/iocrate/netkit/tree/master/netkit/buffer/circular.nim#L398" class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/iocrate/netkit/edit/devel/netkit/buffer/circular.nim#L398" class="link-seesrc" target="_blank">Edit</a>

</dd>
<a id="markUntil,MarkableCircularBuffer,char"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#markUntil%2CMarkableCircularBuffer%2Cchar"><span class="Identifier">markUntil</span></a><span class="Other">(</span><span class="Identifier">b</span><span class="Other">:</span> <span class="Keyword">var</span> <a href="circular.html#MarkableCircularBuffer"><span class="Identifier">MarkableCircularBuffer</span></a><span class="Other">;</span> <span class="Identifier">c</span><span class="Other">:</span> <span class="Identifier">char</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">bool</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

<p>Marks the stored data one by one until a byte is <tt class="docutils literal"><span class="pre">c</span></tt>. <tt class="docutils literal"><span class="pre">false</span></tt> is returned if no byte is <tt class="docutils literal"><span class="pre">c</span></tt>.</p>
<p>Note that the marking is performed incrementally, that is, when the marking operation is called next time, it will continue from the position where it last ended.</p>

&nbsp;&nbsp;<a href="https://github.com/iocrate/netkit/tree/master/netkit/buffer/circular.nim#L412" class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/iocrate/netkit/edit/devel/netkit/buffer/circular.nim#L412" class="link-seesrc" target="_blank">Edit</a>

</dd>
<a id="markAll,MarkableCircularBuffer"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#markAll%2CMarkableCircularBuffer"><span class="Identifier">markAll</span></a><span class="Other">(</span><span class="Identifier">b</span><span class="Other">:</span> <span class="Keyword">var</span> <a href="circular.html#MarkableCircularBuffer"><span class="Identifier">MarkableCircularBuffer</span></a><span class="Other">)</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

<p>Marks all the stored data.</p>
<p>Note that the marking is performed incrementally, that is, when the marking operation is called next time, it will continue from the position where it last ended.</p>

&nbsp;&nbsp;<a href="https://github.com/iocrate/netkit/tree/master/netkit/buffer/circular.nim#L422" class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/iocrate/netkit/edit/devel/netkit/buffer/circular.nim#L422" class="link-seesrc" target="_blank">Edit</a>

</dd>
<a id="lenMarks,MarkableCircularBuffer"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#lenMarks%2CMarkableCircularBuffer"><span class="Identifier">lenMarks</span></a><span class="Other">(</span><span class="Identifier">b</span><span class="Other">:</span> <a href="circular.html#MarkableCircularBuffer"><span class="Identifier">MarkableCircularBuffer</span></a><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">Natural</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">inline</span><span class="Other">,</span> <span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Returns the length of the stored data that has been marked.
&nbsp;&nbsp;<a href="https://github.com/iocrate/netkit/tree/master/netkit/buffer/circular.nim#L429" class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/iocrate/netkit/edit/devel/netkit/buffer/circular.nim#L429" class="link-seesrc" target="_blank">Edit</a>

</dd>
<a id="popMarks,MarkableCircularBuffer,Natural"></a>
<dt><pre><span class="Keyword">proc</span> <a href="#popMarks%2CMarkableCircularBuffer%2CNatural"><span class="Identifier">popMarks</span></a><span class="Other">(</span><span class="Identifier">b</span><span class="Other">:</span> <span class="Keyword">var</span> <a href="circular.html#MarkableCircularBuffer"><span class="Identifier">MarkableCircularBuffer</span></a><span class="Other">;</span> <span class="Identifier">n</span><span class="Other">:</span> <span class="Identifier">Natural</span> <span class="Other">=</span> <span class="DecNumber">0</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">string</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Pops the marked data, skip the data from the end forward by <tt class="docutils literal"><span class="pre">n</span></tt> bytes, and return it as a string. At the same time, delete these data.
&nbsp;&nbsp;<a href="https://github.com/iocrate/netkit/tree/master/netkit/buffer/circular.nim#L433" class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/iocrate/netkit/edit/devel/netkit/buffer/circular.nim#L433" class="link-seesrc" target="_blank">Edit</a>

</dd>

</dl></div>
<div class="section" id="15">
<h1><a class="toc-backref" href="#15">Iterators</a></h1>
<dl class="item">
<a id="items.i,CircularBuffer"></a>
<dt><pre><span class="Keyword">iterator</span> <a href="#items.i%2CCircularBuffer"><span class="Identifier">items</span></a><span class="Other">(</span><span class="Identifier">b</span><span class="Other">:</span> <a href="circular.html#CircularBuffer"><span class="Identifier">CircularBuffer</span></a><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">char</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

Iterates over the stored data. 
&nbsp;&nbsp;<a href="https://github.com/iocrate/netkit/tree/master/netkit/buffer/circular.nim#L339" class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/iocrate/netkit/edit/devel/netkit/buffer/circular.nim#L339" class="link-seesrc" target="_blank">Edit</a>

</dd>
<a id="marks.i,MarkableCircularBuffer"></a>
<dt><pre><span class="Keyword">iterator</span> <a href="#marks.i%2CMarkableCircularBuffer"><span class="Identifier">marks</span></a><span class="Other">(</span><span class="Identifier">b</span><span class="Other">:</span> <span class="Keyword">var</span> <a href="circular.html#MarkableCircularBuffer"><span class="Identifier">MarkableCircularBuffer</span></a><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">char</span> <span><span class="Other">{</span><span class="Other pragmadots">...</span><span class="Other">}</span></span><span class="pragmawrap"><span class="Other">{.</span><span class="pragma"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span><span class="Other">.}</span></span></pre></dt>
<dd>

<p>Iterate over the stored data, and marks the data at the same time.</p>
<p>Note that the marking is performed incrementally, that is, when the marking operation is called next time, it will continue from the position where it last ended.</p>
<pre class="listing"><span class="Keyword">var</span> <span class="Identifier">s</span> <span class="Operator">=</span> <span class="StringLit">"Hello World</span><span class="EscapeSequence">\R</span><span class="EscapeSequence">\L</span><span class="StringLit">"</span>
<span class="Keyword">var</span> <span class="Identifier">n</span> <span class="Operator">=</span> <span class="Identifier">b</span><span class="Operator">.</span><span class="Identifier">put</span><span class="Punctuation">(</span><span class="Identifier">s</span><span class="Operator">.</span><span class="Identifier">cstring</span><span class="Punctuation">,</span> <span class="Identifier">s</span><span class="Operator">.</span><span class="Identifier">len</span><span class="Punctuation">)</span>

<span class="Keyword">for</span> <span class="Identifier">c</span> <span class="Keyword">in</span> <span class="Identifier">b</span><span class="Operator">.</span><span class="Identifier">marks</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span>
  <span class="Keyword">if</span> <span class="Identifier">c</span> <span class="Operator">==</span> <span class="CharLit">'\L'</span><span class="Punctuation">:</span>
    <span class="Keyword">break</span></pre>
&nbsp;&nbsp;<a href="https://github.com/iocrate/netkit/tree/master/netkit/buffer/circular.nim#L379" class="link-seesrc" target="_blank">Source</a>
<a href="https://github.com/iocrate/netkit/edit/devel/netkit/buffer/circular.nim#L379" class="link-seesrc" target="_blank">Edit</a>

</dd>

</dl></div>

  </div>
</div>

    <div class="row">
      <div class="twelve-columns footer">
        <span class="nim-sprite"></span>
        <br>
        <small style="color: var(--hint);">Made with Nim. Generated: 2020-04-29 10:20:24 UTC</small>
      </div>
    </div>
  </div>
</div>



</body></html>